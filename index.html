<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>1.5 ABFIT - App Completo</title>
    
    <meta name="theme-color" content="#000000" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Chakra+Petch:wght@700&display=swap" rel="stylesheet">
    
    <!-- Babel (Para rodar React direto no navegador sem build) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Configura√ß√£o Tailwind -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              display: ['Chakra Petch', 'sans-serif'],
            },
            animation: {
              fadeIn: 'fadeIn 0.4s ease-out',
              bounceIn: 'bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)',
            },
            keyframes: {
              fadeIn: { 'from': { opacity: '0' }, 'to': { opacity: '1' } },
              bounceIn: { '0%': { transform: 'scale(0.3)', opacity: '0' }, '50%': { transform: 'scale(1.05)' }, '70%': { transform: 'scale(0.9)' }, '100%': { transform: 'scale(1)', opacity: '1' } }
            }
          }
        }
      }
    </script>

    <style>
        /* Custom Scrollbar e Ajustes Globais */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #18181b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 2px; }
        body { background-color: #000; color: white; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .input-dark { background: #111; border: 1px solid #333; color: white; }
        .glass-panel { background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "recharts": "https://esm.sh/recharts@^3.6.0",
    "react-markdown": "https://esm.sh/react-markdown@^10.1.0",
    "firebase/": "https://esm.sh/firebase@^12.7.0/"
  }
}
</script>
</head>
<body class="bg-black text-white antialiased selection:bg-red-900 selection:text-white">
    <div id="root"></div>

    <!-- SCRIPT PRINCIPAL DA APLICA√á√ÉO -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            ArrowLeft, Save, Trash2, Dumbbell, Brain, Search, PlayCircle, Plus, 
            User, LogOut, Activity, CalendarDays, Map, Flag, ClipboardList, Cloud, 
            ChevronLeft, ChevronRight, CheckCircle2, Home, Target, Bell, BellRing, 
            Clock, X, Users, ChartLine, Loader2, Send, Bot, Medal, Zap, Crown, Star, 
            Minus, Share2, MapPin, Flame, Snowflake, TrendingUp, Play
        } from 'https://esm.sh/lucide-react@0.263.1';
        import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'https://esm.sh/recharts@2.12.0';
        import ReactMarkdown from 'https://esm.sh/react-markdown@9.0.0';
        import { GoogleGenAI } from 'https://esm.sh/@google/genai@0.1.0';

        // ============================================================================
        // 1. CONFIGURA√á√ïES E DADOS GLOBAIS
        // ============================================================================

        // --- API KEY (Coloque sua chave aqui para ativar a IA) ---
        const API_KEY = ""; 

        // --- Imagens de Fundo ---
        const GYM_BACKGROUNDS = [
            'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=1920&auto=format&fit=crop',
            'https://images.unsplash.com/photo-1583454110551-21f2fa2afe61?q=80&w=1920&auto=format&fit=crop',
            'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=1920&auto=format&fit=crop',
            'https://images.unsplash.com/photo-1590487988256-9ed24133863e?q=80&w=1920&auto=format&fit=crop'
        ];

        // --- Banco de Exerc√≠cios ---
        const getThumb = (keywords) => 
            `https://image.pollinations.ai/prompt/gym%20workout%20exercise%20${keywords}%20fitness%20cinematic%20lighting?width=300&height=200&nologo=true`;

        const EXERCISE_DATABASE = {
            'Gl√∫teos': [
                { id: 'elevacao_pelvica', name: 'Eleva√ß√£o P√©lvica', videoUrl: getThumb('hip-thrust') },
                { id: 'agachamento_sumo', name: 'Agachamento Sum√¥', videoUrl: getThumb('sumo-squat') },
                { id: 'afundo', name: 'Afundo B√∫lgaro', videoUrl: getThumb('bulgarian-split-squat') }
            ],
            'Pernas': [
                { id: 'agachamento', name: 'Agachamento Livre', videoUrl: getThumb('squat') },
                { id: 'leg_press', name: 'Leg Press 45', videoUrl: getThumb('leg-press') },
                { id: 'extensora', name: 'Cadeira Extensora', videoUrl: getThumb('leg-extension') }
            ],
            'Superiores': [
                { id: 'supino', name: 'Supino Reto', videoUrl: getThumb('bench-press') },
                { id: 'remada', name: 'Remada Curvada', videoUrl: getThumb('barbell-row') },
                { id: 'desenvolvimento', name: 'Desenvolvimento Ombros', videoUrl: getThumb('shoulder-press') }
            ]
        };

        const DEFAULT_ACHIEVEMENTS = [
            { id: 'welcome', title: 'Bem-vindo', description: 'Iniciou a jornada', icon: 'medal', unlocked: true },
            { id: 'first_workout', title: 'Primeiro Treino', description: 'Concluiu 1 treino', icon: 'zap', unlocked: false },
            { id: 'consistent', title: 'Consistente', description: '3 treinos na semana', icon: 'crown', unlocked: false }
        ];

        // ============================================================================
        // 2. SERVI√áOS (Storage & IA)
        // ============================================================================

        const STORAGE_KEY = 'abfit_data_v2';

        const StorageService = {
            getStudents: () => {
                const data = localStorage.getItem(STORAGE_KEY);
                if (!data) return StorageService.initData();
                return JSON.parse(data);
            },
            saveStudents: (students) => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(students));
            },
            initData: () => {
                const initialData = [
                    { 
                        id: '1', nome: 'Andr√© Brito', email: 'admin@abfit.com', role: 'admin', photoUrl: 'https://images.unsplash.com/photo-1522075469751-3a6694fb2f61?q=80&w=200&fit=crop',
                        workouts: [], goals: [], achievements: [...DEFAULT_ACHIEVEMENTS], history: [], runningWorkouts: []
                    },
                    { 
                        id: '2', nome: 'Aluno Teste', email: 'aluno@teste.com', role: 'student', 
                        workouts: [{ id: 'w1', title: 'Adapta√ß√£o A', description: 'Full Body', exercises: [{id:'e1', name:'Agachamento', sets:'3', reps:'12', load:'10kg', rest:'60s'}] }],
                        goals: [], achievements: [...DEFAULT_ACHIEVEMENTS], history: [], runningWorkouts: []
                    }
                ];
                localStorage.setItem(STORAGE_KEY, JSON.stringify(initialData));
                return initialData;
            }
        };

        const AIService = {
            sendMessage: async (message, history = []) => {
                if (!API_KEY) return "‚ö†Ô∏è Configure a API Key no c√≥digo (vari√°vel API_KEY) para usar a IA.";
                try {
                    const ai = new GoogleGenAI({ apiKey: API_KEY });
                    const chat = ai.chats.create({
                        model: 'gemini-3-flash-preview',
                        config: { systemInstruction: "Voc√™ √© o Coach da ABFIT. Responda de forma motivadora, t√©cnica e breve." },
                        history: history
                    });
                    const result = await chat.sendMessage({ message });
                    return result.text;
                } catch (error) {
                    console.error("Erro IA:", error);
                    return "Erro de conex√£o com a IA. Verifique a chave ou a internet.";
                }
            }
        };

        // ============================================================================
        // 3. COMPONENTES DE UI
        // ============================================================================

        const BackgroundWrapper = ({ children, trigger }) => {
            const [bg, setBg] = useState(GYM_BACKGROUNDS[0]);
            const [opacity, setOpacity] = useState(1);
            
            useEffect(() => {
                setOpacity(0.2);
                setTimeout(() => {
                    setBg(GYM_BACKGROUNDS[Math.floor(Math.random() * GYM_BACKGROUNDS.length)]);
                    setOpacity(1);
                }, 300);
            }, [trigger]);

            return (
                <div className="relative min-h-screen bg-black text-white">
                    <div className="fixed inset-0 z-0 bg-cover bg-center transition-opacity duration-700 ease-in-out" style={{ backgroundImage: `url(${bg})`, opacity: opacity }}></div>
                    <div className="fixed inset-0 z-0 bg-gradient-to-b from-black/90 via-black/80 to-black/95 pointer-events-none"></div>
                    <div className="relative z-10 min-h-screen flex flex-col">{children}</div>
                </div>
            );
        };

        // --- TELA: LOGIN ---
        const LoginScreen = ({ onLogin, students }) => {
            const [email, setEmail] = useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                const user = students.find(s => s.email === email) || (email === 'admin@abfit.com' ? students[0] : null);
                if (user) onLogin(user);
                else alert('Usu√°rio n√£o encontrado. Tente: aluno@teste.com');
            };

            return (
                <div className="flex-1 flex flex-col items-center justify-center p-8 animate-fadeIn">
                    <div className="mb-12 text-center">
                        <h1 className="text-7xl font-black italic tracking-tighter flex items-center justify-center transform -skew-x-12 drop-shadow-2xl">
                            <span className="text-red-600 mr-1">AB</span><span className="text-white">FIT</span>
                        </h1>
                        <p className="text-zinc-400 text-xs tracking-[0.3em] uppercase mt-4">Performance & Sa√∫de</p>
                    </div>
                    <form onSubmit={handleSubmit} className="w-full max-w-xs space-y-6">
                        <div className="relative group">
                            <User className="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500 group-focus-within:text-red-500 w-5 h-5 transition-colors" />
                            <input 
                                type="text" 
                                placeholder="Seu E-mail" 
                                value={email}
                                onChange={e => setEmail(e.target.value)}
                                className="w-full bg-zinc-900/80 border border-zinc-800 rounded-xl py-4 pl-10 pr-4 text-white placeholder-zinc-500 focus:border-red-600 focus:outline-none focus:ring-1 focus:ring-red-600 transition-all"
                            />
                        </div>
                        <button className="w-full bg-red-600 hover:bg-red-500 text-white font-black uppercase tracking-widest py-4 rounded-xl shadow-[0_0_20px_rgba(220,38,38,0.3)] transition-all active:scale-95">
                            Acessar Treinos
                        </button>
                    </form>
                    <p className="mt-8 text-zinc-600 text-xs">Login teste: <span className="font-mono text-zinc-400">aluno@teste.com</span></p>
                </div>
            );
        };

        // --- TELA: DASHBOARD ALUNO ---
        const StudentDashboard = ({ user, onNavigate, onLogout }) => {
            return (
                <div className="pb-24 animate-fadeIn">
                    <header className="p-6 flex justify-between items-center glass-panel sticky top-0 z-20">
                        <div>
                            <h2 className="text-2xl font-black italic"><span className="text-red-600">AB</span>FIT</h2>
                        </div>
                        <button onClick={onLogout}><LogOut className="text-zinc-400 hover:text-white" /></button>
                    </header>

                    <div className="p-6 flex items-center gap-4">
                        <div className="w-16 h-16 rounded-full p-[2px] bg-gradient-to-br from-red-600 to-red-900">
                            <img src={user.photoUrl || "https://placehold.co/100"} className="w-full h-full rounded-full object-cover border-2 border-black" />
                        </div>
                        <div>
                            <h3 className="text-xl font-bold">Ol√°, {user.nome.split(' ')[0]}</h3>
                            <p className="text-xs text-zinc-400">Foco no objetivo hoje! üí™</p>
                        </div>
                    </div>

                    <div className="px-4 grid grid-cols-2 gap-3">
                        <button onClick={() => onNavigate('WORKOUTS')} className="col-span-2 bg-gradient-to-br from-red-900/40 to-black border border-red-900/50 p-6 rounded-2xl flex items-center gap-4 hover:border-red-500 transition-all group">
                            <div className="w-12 h-12 rounded-full bg-red-600 flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-transform">
                                <Dumbbell className="w-6 h-6" />
                            </div>
                            <div className="text-left">
                                <h4 className="font-black text-lg uppercase italic">Meus Treinos</h4>
                                <p className="text-xs text-zinc-400">Acesse sua rotina</p>
                            </div>
                        </button>
                        
                        <button onClick={() => onNavigate('AI_CHAT')} className="bg-zinc-900/60 border border-zinc-800 p-4 rounded-xl flex flex-col items-center gap-2 hover:bg-zinc-800 transition-all">
                            <Brain className="w-8 h-8 text-blue-500" />
                            <span className="text-xs font-bold uppercase">AB Coach IA</span>
                        </button>

                        <button onClick={() => onNavigate('GOALS')} className="bg-zinc-900/60 border border-zinc-800 p-4 rounded-xl flex flex-col items-center gap-2 hover:bg-zinc-800 transition-all">
                            <Target className="w-8 h-8 text-yellow-500" />
                            <span className="text-xs font-bold uppercase">Metas</span>
                        </button>

                         <button onClick={() => onNavigate('RUNNING')} className="col-span-2 bg-zinc-900/60 border border-zinc-800 p-4 rounded-xl flex items-center justify-between px-6 hover:bg-zinc-800 transition-all">
                             <div className="flex items-center gap-3">
                                <Activity className="w-6 h-6 text-orange-500" />
                                <span className="font-bold uppercase text-sm">Planilha de Corrida</span>
                             </div>
                             <ChevronRight className="w-5 h-5 text-zinc-600" />
                        </button>
                    </div>
                </div>
            );
        };

        // --- TELA: CHAT IA ---
        const AIChatScreen = ({ userName, onBack }) => {
            const [messages, setMessages] = useState([{role: 'model', text: `Fala, ${userName.split(' ')[0]}! Sou a IA da ABFIT. D√∫vidas sobre o treino ou dieta?`}]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const scrollRef = useRef(null);

            useEffect(() => scrollRef.current?.scrollIntoView({behavior: 'smooth'}), [messages]);

            const handleSend = async () => {
                if(!input.trim()) return;
                const userText = input;
                setInput('');
                setMessages(prev => [...prev, {role: 'user', text: userText}]);
                setLoading(true);
                
                const response = await AIService.sendMessage(userText, messages.map(m => ({role: m.role, parts: [{text: m.text}]})));
                
                setMessages(prev => [...prev, {role: 'model', text: response}]);
                setLoading(false);
            };

            return (
                <div className="flex flex-col h-screen bg-black absolute inset-0 z-50 animate-fadeIn">
                    <div className="p-4 bg-zinc-900 border-b border-zinc-800 flex items-center gap-3">
                        <button onClick={onBack}><ArrowLeft className="text-zinc-400" /></button>
                        <h2 className="font-black italic">AB <span className="text-blue-500">COACH</span></h2>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {messages.map((m, i) => (
                            <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[85%] p-3 rounded-2xl text-sm ${m.role === 'user' ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-zinc-800 text-zinc-300 rounded-tl-none'}`}>
                                    <ReactMarkdown>{m.text}</ReactMarkdown>
                                </div>
                            </div>
                        ))}
                        {loading && <div className="text-zinc-500 text-xs flex items-center gap-2"><Loader2 className="w-3 h-3 animate-spin" /> Digitando...</div>}
                        <div ref={scrollRef}></div>
                    </div>
                    <div className="p-4 bg-zinc-900 border-t border-zinc-800 flex gap-2">
                        <input value={input} onChange={e => setInput(e.target.value)} placeholder="Pergunte algo..." className="flex-1 bg-black border border-zinc-700 rounded-xl px-4 py-3 outline-none focus:border-blue-500" />
                        <button onClick={handleSend} disabled={loading} className="bg-blue-600 p-3 rounded-xl"><Send className="w-5 h-5 text-white" /></button>
                    </div>
                </div>
            );
        };

        // --- TELA: LISTA DE TREINOS ---
        const WorkoutListScreen = ({ user, onSelectWorkout, onBack }) => {
            return (
                <div className="min-h-screen bg-black p-4 animate-fadeIn">
                    <div className="flex items-center gap-4 mb-6">
                        <button onClick={onBack} className="bg-zinc-900 p-2 rounded-full"><ArrowLeft className="w-5 h-5" /></button>
                        <h2 className="text-xl font-bold uppercase">Seus Treinos</h2>
                    </div>
                    <div className="space-y-4">
                        {user.workouts.length === 0 && <p className="text-zinc-500 text-center mt-10">Nenhum treino atribu√≠do.</p>}
                        {user.workouts.map(w => (
                            <button key={w.id} onClick={() => onSelectWorkout(w)} className="w-full bg-zinc-900 border border-zinc-800 p-5 rounded-2xl text-left hover:border-red-600 transition-all group relative overflow-hidden">
                                <div className="absolute inset-0 bg-gradient-to-r from-transparent via-transparent to-red-900/10 group-hover:to-red-900/20 transition-all"></div>
                                <h3 className="font-black text-lg text-white italic">{w.title}</h3>
                                <p className="text-sm text-zinc-400">{w.description}</p>
                                <div className="mt-3 flex gap-2">
                                    <span className="bg-black/40 px-2 py-1 rounded text-xs text-zinc-500">{w.exercises.length} Exerc√≠cios</span>
                                </div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- TELA: EXECU√á√ÉO DE TREINO ---
        const WorkoutSessionScreen = ({ workout, onFinish }) => {
            const [timer, setTimer] = useState(0);
            
            useEffect(() => {
                const i = setInterval(() => setTimer(t => t + 1), 1000);
                return () => clearInterval(i);
            }, []);

            const formatTime = (s) => new Date(s * 1000).toISOString().substr(11, 8);

            return (
                <div className="min-h-screen bg-black pb-24 animate-fadeIn">
                    <div className="sticky top-0 bg-black/90 backdrop-blur-md border-b border-zinc-800 p-4 flex justify-between items-center z-30">
                        <div>
                            <p className="text-[10px] text-zinc-500 uppercase tracking-wider">{workout.title}</p>
                            <h1 className="text-3xl font-mono font-black text-red-600">{formatTime(timer)}</h1>
                        </div>
                        <button onClick={onFinish} className="bg-red-600 px-4 py-2 rounded-lg font-bold text-xs uppercase">Encerrar</button>
                    </div>

                    <div className="p-4 space-y-4">
                        {workout.exercises.map((ex, i) => (
                            <div key={i} className="bg-zinc-900 rounded-xl overflow-hidden border border-zinc-800">
                                <div className="flex p-3 gap-3">
                                    <div className="w-20 h-20 bg-zinc-800 rounded-lg overflow-hidden flex-shrink-0 relative">
                                        <img src={`https://image.pollinations.ai/prompt/gym%20${ex.name}?width=100&height=100&nologo=true`} className="w-full h-full object-cover opacity-70" />
                                    </div>
                                    <div className="flex-1">
                                        <h4 className="font-bold text-sm text-white mb-1">{ex.name}</h4>
                                        <div className="flex gap-2 text-xs">
                                            <div className="bg-black px-2 py-1 rounded border border-zinc-700 text-zinc-300">
                                                <span className="font-bold text-white">{ex.sets}</span> S√©ries
                                            </div>
                                            <div className="bg-black px-2 py-1 rounded border border-zinc-700 text-zinc-300">
                                                <span className="font-bold text-white">{ex.reps}</span> Reps
                                            </div>
                                        </div>
                                        {ex.load && <p className="text-xs text-zinc-500 mt-2">Carga: {ex.load}</p>}
                                    </div>
                                    <input type="checkbox" className="w-6 h-6 accent-red-600 self-center" />
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- COMPONENTE PRINCIPAL (APP) ---
        const App = () => {
            const [view, setView] = useState('LOGIN');
            const [user, setUser] = useState(null);
            const [students, setStudents] = useState([]);
            const [selectedWorkout, setSelectedWorkout] = useState(null);

            useEffect(() => {
                setStudents(StorageService.getStudents());
            }, []);

            const handleLogin = (u) => {
                setUser(u);
                setView(u.role === 'admin' ? 'ADMIN' : 'DASHBOARD');
            };

            const handleLogout = () => {
                setUser(null);
                setView('LOGIN');
            };

            const updateStudentsData = (newStudents) => {
                setStudents(newStudents);
                StorageService.saveStudents(newStudents);
            };

            return (
                <BackgroundWrapper trigger={view}>
                    {view === 'LOGIN' && <LoginScreen onLogin={handleLogin} students={students} />}
                    
                    {view === 'DASHBOARD' && (
                        <StudentDashboard 
                            user={user} 
                            onLogout={handleLogout} 
                            onNavigate={(v) => setView(v)}
                        />
                    )}

                    {view === 'AI_CHAT' && <AIChatScreen userName={user?.nome} onBack={() => setView('DASHBOARD')} />}
                    
                    {view === 'WORKOUTS' && (
                        <WorkoutListScreen 
                            user={user} 
                            onBack={() => setView('DASHBOARD')} 
                            onSelectWorkout={(w) => { setSelectedWorkout(w); setView('SESSION'); }} 
                        />
                    )}

                    {view === 'SESSION' && selectedWorkout && (
                        <WorkoutSessionScreen 
                            workout={selectedWorkout} 
                            onFinish={() => setView('WORKOUTS')} 
                        />
                    )}

                    {/* Telas Placeholder para Metas e Corrida */}
                    {(view === 'GOALS' || view === 'RUNNING') && (
                        <div className="flex flex-col items-center justify-center h-screen p-6 text-center animate-fadeIn">
                            <h2 className="text-2xl font-bold mb-2">Em Breve</h2>
                            <p className="text-zinc-500 mb-6">Esta funcionalidade est√° em desenvolvimento.</p>
                            <button onClick={() => setView('DASHBOARD')} className="text-red-500 font-bold uppercase">Voltar</button>
                        </div>
                    )}

                    {view === 'ADMIN' && (
                        <div className="p-6 text-center pt-20">
                            <h1 className="text-2xl font-bold">Painel Professor</h1>
                            <p className="text-zinc-500 mb-6">Gerencie alunos pelo desktop.</p>
                            <button onClick={handleLogout} className="bg-zinc-800 px-4 py-2 rounded text-white">Sair</button>
                        </div>
                    )}
                </BackgroundWrapper>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>